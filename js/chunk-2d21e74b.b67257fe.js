(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21e74b"],{d647:function(e,t,n){"use strict";n.r(t);var o=n("7a23"),c={class:"text-end mt-5"},a={class:"table-responsive mt-3"},l={class:"table table-hover"},r=Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{class:"d-none d-sm-table-cell"},"名稱"),Object(o["createElementVNode"])("th",{class:"d-none d-sm-table-cell"},"優惠碼"),Object(o["createElementVNode"])("th",null,"折扣百分比"),Object(o["createElementVNode"])("th",null,"到期日"),Object(o["createElementVNode"])("th",null,"是否啟用"),Object(o["createElementVNode"])("th",null,"編輯")])],-1),d={class:"d-none d-sm-table-cell"},i={class:"d-none d-sm-table-cell"},s={class:"d-none d-sm-table-cell"},u={key:0,class:"text-success"},p={key:1,class:"text-muted"},b={class:"btn-group btn-group-sm"},m=["onClick"],j=["onClick"];function O(e,t,n,O,h,f){var v=Object(o["resolveComponent"])("Loading"),g=Object(o["resolveComponent"])("Pagination"),E=Object(o["resolveComponent"])("CouponModal"),N=Object(o["resolveComponent"])("DelModal");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createVNode"])(v,{isLoading:e.isLoading},null,8,["isLoading"]),Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("button",{type:"button",class:"btn btn-primary btn-block",onClick:t[0]||(t[0]=function(e){return O.openModal("new")})}," 建立新的優惠券 ")]),Object(o["createElementVNode"])("div",a,[Object(o["createElementVNode"])("table",l,[r,Object(o["createElementVNode"])("tbody",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.coupons,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{key:t.id},[Object(o["createElementVNode"])("td",d,Object(o["toDisplayString"])(t.title),1),Object(o["createElementVNode"])("td",i,Object(o["toDisplayString"])(t.code),1),Object(o["createElementVNode"])("td",s,Object(o["toDisplayString"])(t.percent),1),Object(o["createElementVNode"])("td",null,Object(o["toDisplayString"])(e.$filters.date(t.due_date)),1),Object(o["createElementVNode"])("td",null,[1===t.is_enabled?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",u,"啟用")):(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",p,"未啟用"))]),Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("div",b,[Object(o["createElementVNode"])("button",{type:"button",class:"btn btn-outline-primary",onClick:function(e){return O.openModal("edit",t)}}," 編輯 ",8,m),Object(o["createElementVNode"])("button",{type:"button",class:"btn btn-outline-danger",onClick:function(e){return O.openModal("delete",t)}}," 刪除 ",8,j)])])])})),128))])]),Object(o["createVNode"])(g,{pages:e.pagination,onEmitPage:O.getCoupons},null,8,["pages","onEmitPage"]),Object(o["createVNode"])(E,{ref:"couponModal",coupon:e.tempCoupon,isNew:e.isNew,onEmitUpdate:O.updateCoupon},null,8,["coupon","isNew","onEmitUpdate"]),Object(o["createVNode"])(N,{ref:"delModal",item:e.tempCoupon,onEmitDelete:O.deleteCoupon},null,8,["item","onEmitDelete"])])],64)}var h=n("5530"),f=n("1da1"),v=(n("96cf"),n("99af"),{class:"modal fade",tabindex:"-1","aria-hidden":"true",ref:"modal"}),g={class:"modal-dialog"},E={class:"modal-content"},N={class:"modal-header"},V={key:0,class:"modal-title"},k={key:1},C={class:"modal-body"},w={class:"mb-3"},y=Object(o["createElementVNode"])("label",{for:"title",class:"form-label"},"標題",-1),M={class:"mb-3"},x=Object(o["createElementVNode"])("label",{for:"code",class:"form-label"},"優惠碼",-1),B={class:"mb-3"},_=Object(o["createElementVNode"])("label",{for:"due_date",class:"form-label"},"到期日",-1),D={class:"mb-3"},L=Object(o["createElementVNode"])("label",{for:"percent",class:"form-label"},"折扣百分比",-1),U={class:"form-check"},P=Object(o["createElementVNode"])("label",{for:"is_enabled",class:"form-check-label"},"是否啟用",-1),R={class:"modal-footer"};function S(e,t,n,c,a,l){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",v,[Object(o["createElementVNode"])("div",g,[Object(o["createElementVNode"])("div",E,[Object(o["createElementVNode"])("div",N,[n.isNew?(Object(o["openBlock"])(),Object(o["createElementBlock"])("h5",V,"新增優惠券")):(Object(o["openBlock"])(),Object(o["createElementBlock"])("h5",k,"編輯優惠券")),Object(o["createElementVNode"])("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=function(){return c.hideModal&&c.hideModal.apply(c,arguments)}),"aria-label":"Close"})]),Object(o["createElementVNode"])("div",C,[Object(o["createElementVNode"])("div",w,[y,Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"text",id:"title",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.tempCoupon.title=t})},null,512),[[o["vModelText"],e.tempCoupon.title]])]),Object(o["createElementVNode"])("div",M,[x,Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"text",id:"code",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.tempCoupon.code=t})},null,512),[[o["vModelText"],e.tempCoupon.code]])]),Object(o["createElementVNode"])("div",B,[_,Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"date",id:"due_date",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=function(t){return e.due_date=t})},null,512),[[o["vModelText"],e.due_date]])]),Object(o["createElementVNode"])("div",D,[L,Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"number",id:"percent",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[4]||(t[4]=function(t){return e.tempCoupon.percent=t})},null,512),[[o["vModelText"],e.tempCoupon.percent,void 0,{number:!0}]])]),Object(o["createElementVNode"])("div",U,[Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=function(t){return e.tempCoupon.is_enabled=t}),"true-value":1,"false-value":0},null,512),[[o["vModelCheckbox"],e.tempCoupon.is_enabled,void 0,{number:!0}]]),P])]),Object(o["createElementVNode"])("div",R,[Object(o["createElementVNode"])("button",{type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=function(){return c.hideModal&&c.hideModal.apply(c,arguments)})},"取消"),n.isNew?(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=function(t){return c.emitUpdate(e.tempCoupon)})},"新增優惠券 ")):(Object(o["openBlock"])(),Object(o["createElementBlock"])("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=function(t){return c.emitUpdate(e.tempCoupon)})}," 更新優惠券"))])])])],512)}var T=n("3835"),F=(n("ac1f"),n("1276"),n("53cb")),J={props:{coupon:{type:Object,default:function(){return{}}},isNew:{type:Boolean,default:!1}},emits:["emit-update"],setup:function(e,t){var n=Object(F["a"])(),c=n.modal,a=n.modalBox,l=n.showModal,r=n.hideModal,d=Object(o["reactive"])({tempCoupon:{},due_date:""});function i(e){t.emit("emit-update",e)}Object(o["watch"])((function(){return e.coupon}),(function(){d.tempCoupon=Object(h["a"])({},e.coupon);var t=new Date(1e3*d.tempCoupon.due_date).toISOString().split("T"),n=Object(T["a"])(t,1);d.due_date=n[0]})),Object(o["watch"])((function(){return d.due_date}),(function(){d.tempCoupon.due_date=Math.floor(new Date(d.due_date)/1e3)}));var s=Object(o["toRefs"])(d);return Object(h["a"])({modal:c,modalBox:a,showModal:l,hideModal:r,emitUpdate:i},s)}},I=n("6b0d"),$=n.n(I);const q=$()(J,[["render",S]]);var z=q,A=n("6ff1"),G=n("1799"),H=n("3a5e"),K={components:{CouponModal:z,DelModal:A["a"],Loading:H["a"],Pagination:G["a"]},setup:function(){var e=Object(o["inject"])("Message"),t=Object(o["inject"])("axios"),n=Object(o["reactive"])({coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1,currentPage:1}),c=Object(o["ref"])(null),a=Object(o["ref"])(null);function l(){return r.apply(this,arguments)}function r(){return r=Object(f["a"])(regeneratorRuntime.mark((function o(){var c,a,l,r=arguments;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return c=r.length>0&&void 0!==r[0]?r[0]:1,n.currentPage=c,a="".concat("https://vue3-course-api.hexschool.io","/api/").concat("starlightselection","/admin/coupons?page=").concat(n.currentPage),n.isLoading=!0,o.prev=4,o.next=7,t.get(a);case 7:l=o.sent,l.data.success?(n.coupons=l.data.coupons,n.pagination=l.data.pagination,e("success","取得優惠券成功")):e("error","".concat(l.data.message)),n.isLoading=!1,o.next=16;break;case 12:o.prev=12,o.t0=o["catch"](4),e("error","無法取得優惠券，請再次確認!"),n.isLoading=!1;case 16:case"end":return o.stop()}}),o,null,[[4,12]])}))),r.apply(this,arguments)}function d(e,t){"new"===e?(n.isNew=!0,n.tempCoupon={due_date:Math.floor((new Date).getTime()/1e3),is_enabled:!1},c.value.showModal()):"edit"===e?(n.isNew=!1,n.tempCoupon=Object(h["a"])({},t),c.value.showModal()):"delete"===e&&(n.tempCoupon=t,a.value.showModal())}function i(e){return s.apply(this,arguments)}function s(){return s=Object(f["a"])(regeneratorRuntime.mark((function o(a){var r,d,i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n.tempCoupon=a,r="".concat("https://vue3-course-api.hexschool.io","/api/").concat("starlightselection","/admin/coupon"),d="post",n.isNew||(r="".concat("https://vue3-course-api.hexschool.io","/api/").concat("starlightselection","/admin/coupon/").concat(n.tempCoupon.id),d="put"),n.isLoading=!0,o.prev=5,o.next=8,t[d](r,{data:n.tempCoupon});case 8:i=o.sent,i.data.success?(l(n.currentPage),c.value.hideModal(),e("success","".concat(i.data.message))):e("error","".concat(i.data.message)),n.isLoading=!1,o.next=17;break;case 13:o.prev=13,o.t0=o["catch"](5),e("error","無法修改優惠券，請再次確認!"),n.isLoading=!1;case 17:case"end":return o.stop()}}),o,null,[[5,13]])}))),s.apply(this,arguments)}function u(e){return p.apply(this,arguments)}function p(){return p=Object(f["a"])(regeneratorRuntime.mark((function o(c){var r,d;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r="".concat("https://vue3-course-api.hexschool.io","/api/").concat("starlightselection","/admin/coupon/").concat(c),n.isLoading=!0,o.prev=2,o.next=5,t.delete(r);case 5:d=o.sent,d.data.success?(l(n.currentPage),e("success","優惠券刪除成功"),a.value.hideModal()):e("error","".concat(d.data.message)),n.isLoading=!1,o.next=14;break;case 10:o.prev=10,o.t0=o["catch"](2),e("error","無法刪除優惠券，請再次確認!"),n.isLoading=!1;case 14:case"end":return o.stop()}}),o,null,[[2,10]])}))),p.apply(this,arguments)}l();var b=Object(o["toRefs"])(n);return Object(h["a"])(Object(h["a"])({},b),{},{couponModal:c,openModal:d,updateCoupon:i,delModal:a,deleteCoupon:u,getCoupons:l})}};const Q=$()(K,[["render",O]]);t["default"]=Q}}]);
//# sourceMappingURL=chunk-2d21e74b.b67257fe.js.map